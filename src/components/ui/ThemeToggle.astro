---
import { Sun, Moon } from "lucide-react";
---

<button
    id="theme-toggle"
    class="fixed bottom-5 right-5 z-50 flex h-10 w-10 items-center justify-center rounded-full bg-white/10 backdrop-blur-md border border-white/20 shadow-lg transition-transform hover:scale-110 active:scale-95 cursor-pointer opacity-50 hover:opacity-100"
    aria-label="Toggle Theme"
>
    <span class="sr-only">Toggle dark mode</span>
    <div class="relative w-5 h-5">
        <!-- Sun icon: visible in dark mode (scale-100), hidden in light mode (scale-0) -->
        <div
            class="absolute inset-0 flex items-center justify-center transition-all duration-300 transform rotate-90 scale-0 dark:rotate-0 dark:scale-100 text-yellow-300"
        >
            <Sun size={20} strokeWidth={2.5} />
        </div>
        <!-- Moon icon: visible in light mode (scale-100), hidden in dark mode (scale-0) -->
        <div
            class="absolute inset-0 flex items-center justify-center transition-all duration-300 transform rotate-0 scale-100 dark:-rotate-90 dark:scale-0 text-slate-800"
        >
            <Moon size={20} strokeWidth={2.5} />
        </div>
    </div>
</button>

<script is:inline>
    const handleToggleClick = (event) => {
        const element = document.documentElement;
        // Check if View Transitions API is supported
        if (!document.startViewTransition) {
            element.classList.toggle("dark");
            const isDark = element.classList.contains("dark");
            localStorage.setItem("theme", isDark ? "dark" : "light");
            return;
        }

        const x = event.clientX;
        const y = event.clientY;
        element.style.setProperty("--click-x", `${x}px`);
        element.style.setProperty("--click-y", `${y}px`);

        const isCurrentlyDark = element.classList.contains("dark");
        const isSwitchingToDark = !isCurrentlyDark;

        // Apply temporary class for transition direction
        if (isSwitchingToDark) {
            element.classList.add("dark-transition");
            element.classList.remove("light-transition");
        } else {
            element.classList.add("light-transition");
            element.classList.remove("dark-transition");
        }

        const transition = document.startViewTransition(() => {
            element.classList.toggle("dark");
            const isDark = element.classList.contains("dark");
            localStorage.setItem("theme", isDark ? "dark" : "light");
        });

        // Cleanup classes after transition finished
        transition.finished.finally(() => {
            element.classList.remove("dark-transition", "light-transition");
        });
    };

    document
        .getElementById("theme-toggle")
        ?.addEventListener("click", handleToggleClick);
</script>
