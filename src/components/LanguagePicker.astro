---
import { languages } from "../i18n/ui";
import { getLangFromUrl } from "../i18n/utils";

const lang = getLangFromUrl(Astro.url);

function getPathForLang(l: string) {
    const currentPath = Astro.url.pathname;
    const currentLang = getLangFromUrl(Astro.url);

    // Remove current lang prefix if exists
    let cleanPath = currentPath;
    if (currentLang !== "en" && currentPath.startsWith(`/${currentLang}`)) {
        cleanPath = currentPath.replace(`/${currentLang}`, "");
    }

    // Add new lang prefix
    if (l === "en") {
        return cleanPath || "/";
    }
    if (cleanPath === "/") {
        return `/${l}`;
    }
    return `/${l}${cleanPath}`;
}
---

<div class="language-picker">
    {
        Object.entries(languages).map(([l, label]) => (
            <a href={getPathForLang(l)} class:list={[{ active: l === lang }]}>
                {l.toUpperCase()}
            </a>
        ))
    }
</div>

<style>
    .language-picker {
        display: flex;
        gap: 0.5rem;
        align-items: center;
        font-family:
            system-ui,
            -apple-system,
            BlinkMacSystemFont,
            "Segoe UI",
            Roboto,
            sans-serif;
        font-size: 0.875rem; /* Small typography */
    }

    a {
        text-decoration: none;
        color: inherit;
        opacity: 0.5;
        transition: opacity 0.2s ease;
        font-weight: 500;
    }

    a:hover {
        opacity: 0.8;
    }

    a.active {
        opacity: 1;
        font-weight: 600;
    }
</style>
